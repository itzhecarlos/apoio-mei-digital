<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Apoio MEI Digital | Enviado</title>
    <meta name="description" content="Confirmação de envio e pagamento Pix." />
    <link rel="icon" href="logo.ico" />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <main class="lead-page">
      <section class="section">
        <div class="container">
          <div class="lead-wrapper">
            <div class="lead-intro">
              <p class="badge badge-light">Sucesso</p>
              <h1>Dados enviados com sucesso! ✅</h1>
              <p id="status-msg" style="margin-top: 8px;">
                Clique abaixo para copiar o Pix ou abrir o pagamento.
              </p>
              <div id="pix-actions">
                <button id="copy-btn" class="btn btn-outline-dark" type="button" style="margin-top: 12px;">
                  Copiar código Pix
                </button>

                <a
                  id="pay-link"
                  class="btn"
                  href="#"
                  target="_blank"
                  rel="noopener noreferrer"
                  style="margin-top: 16px;"
                >
                  Pagar Pix com QR Code agora
                </a>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <script>
      const ticketUrl = sessionStorage.getItem("ticket_url");
      const qrCode = sessionStorage.getItem("qr_code");

      const statusMsg = document.getElementById("status-msg");
      const actions = document.getElementById("pix-actions");
      const payLink = document.getElementById("pay-link");
      const copyBtn = document.getElementById("copy-btn");

      if (!ticketUrl || !qrCode) {
        if (statusMsg) {
          statusMsg.textContent =
            "Não encontramos o Pix desta sessão. Volte e envie novamente.";
        }
        if (actions) actions.style.display = "none";
      } else {
        if (payLink) payLink.href = ticketUrl;
      }

      if (copyBtn) {
        copyBtn.addEventListener("click", async () => {
          const value = qrCode || "";
          if (!value) {
            alert("Nenhum código Pix para copiar.");
            return;
          }
          try {
            await navigator.clipboard.writeText(value);
            alert("Código Pix copiado!");
          } catch (error) {
            try {
              const helper = document.createElement("textarea");
              helper.value = value;
              helper.style.position = "fixed";
              helper.style.opacity = "0";
              document.body.appendChild(helper);
              helper.focus();
              helper.select();
              document.execCommand("copy");
              document.body.removeChild(helper);
              alert("Código Pix copiado!");
            } catch (fallbackError) {
              alert("Não foi possível copiar. Copie manualmente no app do banco.");
            }
          }
        });
      }
    </script>
  </body>
</html>
